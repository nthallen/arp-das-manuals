<!DOCTYPE html>
<html>
<head>
<title>Backup3 Manual (QNX4)</title>
<meta name="author" content="webmaster@huarp.harvard.edu">
<meta name="description" content="-">
<meta name="keywords" content="huarp Ozone atmosphere chemistry data acquisition">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
<link rel=stylesheet type="text/css" href="../das.css" title="das">
</head>
<body>
<div id="banner">
<img src="../daq_logo.jpg" width="600" height="100" alt="Anderson Group Data Acquisition Logo" usemap="#daq_map">
<map name="daq_map" id="daq_map">
<area href="http://www.harvard.edu/" shape="rect" coords="10,11,91,35" alt="Harvard Home Page" >
<area href="http://www.arp.harvard.edu/" shape="rect" coords="91,6,246,43" alt="Anderson Group Home Page" >
<area href="http://www.arp.harvard.edu/eng/das/" shape="rect" coords="30,47,273,79" alt="Anderson Group Data Acquisition Home Page" >
</map>
</div>
<br>
<H2>Backup3 Manual</H2>
September 6, 1995
<HR>
<H2>Contents</H2>
<UL>
<LI><A HREF="#P0">0</A>: Invocation
<LI><A HREF="#P1">1</A>: Introduction
<LI><A HREF="#P2">2</A>: File Categories
<UL>
<LI><A HREF="#P2.1">2.1</A>: SOURCE
<LI><A HREF="#P2.2">2.2</A>: OBJECT
<LI><A HREF="#P2.3">2.3</A>: TARGET
<LI><A HREF="#P2.4">2.4</A>: STANDARD
</UL>
<LI><A HREF="#P3">3</A>: Categorize your Files
<LI><A HREF="#P4">4</A>: Performing a Backup
<UL>
<LI><A HREF="#P4.1">4.1</A>: Backing up to Floppy
<LI><A HREF="#P4.2">4.2</A>: Backing up to a File
<LI><A HREF="#P4.3">4.3</A>: Backing up Remotely
</UL>
<LI><A HREF="#P5">5</A>: Incremental Backups
<LI><A HREF="#P6">6</A>: Alternate Invocations
<LI><A HREF="#P7">7</A>: Restoring from a Backup
<LI><A HREF="#A.A">A.A</A>: Appendix A: Environment Variables
<LI><A HREF="#A.B">A.B</A>: Appendix B: Caveats
</UL>
<H2><a id="P0">0</A>: Invocation</H2>
<PRE>    Backup3 [options]
            -l &lt;level&gt; Specify backup level (default is level 0)
            -t &lt;target&gt; One of Backup, Archive, Copyout or CopyRCS
            -d &lt;dest&gt; Destination device, file or directory
            -q Send result via qcp
    
</PRE>

<H2><a id="P1">1</A>: Introduction</H2>

Backup3 is a backup utility specifically tailored to backup 
software source code. When developing software, almost all of the 
work goes into writing the source files. Using these source files 
and some instructions, compilers can generate the desired 
executable code (the "targets") and a number of intermediate 
files, too ("object" files). The target files are crucial to 
running your application. The object files are important only 
during compilation. Since both the object and target files can be 
automatically generated from the source files, we only need to 
save the source files in order to have a complete backup. Since 
source files are generally much smaller than the targets and 
objects, a source backup is quite small, allowing practical 
backups to be performed with nothing more complicated than a 
floppy disk.

<H2><a id="P2">2</A>: File Categories</H2>

In order for Backup3 to do its work, it must know which files are 
SOURCE, OBJECT, TARGET or STANDARD files. Backup3 will look for 
this information in the Makefile. If you are creating a Makefile 
directly, you will want to look closely at the Makefile syntax 
that Backup3 requires, but if you are using <A 
HREF="appgen.html">appgen</A>, your Makefile is automatically 
generated and you need only be concerned with the appgen 
syntax.<P>

<H2><a id="P2.1">2.1</A>: SOURCE</H2>

SOURCE files are all the files which are required to regenerate 
everything in the directory (except STANDARD files). These are 
the only files which Backup3 will save. Within the .spec file and 
many Makefiles, this category is further broken down into SRC,
TOOL, SCRIPT and NONRCS.<P>

SRC files include files which are actual source to some sort of 
compiler, but which are not also the output of another compiler. 
For example, a C source file which you type in called doit.c 
would be a SRC file, but abcdisp.c which is automatically 
generated by the TMC compiler from .tmc sources would not be.<P>

TOOL files help to define how the SOURCE code can be turned into 
executable programs. The Makefile and .spec file fall into this 
category, as do any straight documentation.<P>

SCRIPT files are files which are essentially both SOURCE and 
TARGET. They are files which you edit directly and are also 
required by the runtime system. They need to be backed up, and 
they also need to be distributed to your run directory.<P>

NONRCS files are binary files which would otherwise be SRC files.
A binary file is any file with non-ASCII data. The Revision 
Control System (RCS) which comes with QNX does not handle binary 
files, so it is useful to make this distinction. SRC, TOOL and 
SCRIPT files can all be logged into RCS to keep track of 
revisions over time.<P>

The most important point to take away from this discussion is 
that you can't always tell whether or not a file is a source file 
simply by looking at its name. What might appear to be a source 
file might really be an object file, and in some cases, what 
might appear to be an object file might really be a source file. 
Ultimately there is no substitute for actually knowing what you 
are doing!<P>

This distinction is critical for more than backup. If you edit a 
file which is really an object file, your changes will not be 
backed up and they will be be destroyed the next time the real 
source file is edited.<P>

In really good development environments, the object and target 
files are segregated into separate directories so there is less 
chance for confusion. I am currently looking into adopting such 
an approach, but substantial work is required, so it won't happen 
soon.

<H2><a id="P2.2">2.2</A>: OBJECT</H2>

OBJECT files are intermediate files which are generated by a 
compiler and may be required for a subsequent stage of the 
compilation but are not required at runtime for the final 
application. More generally, OBJECT files are files which can be 
safely deleted when you are not compiling without affecting the 
runtime system or the source code.<P>

Within Makefiles, OBJECT might be broken down to include OBJ and 
TEMP, where OBJ files are the true intermediate files and TEMP 
are other temporary files which are not required further. Error 
listings from a compiler are an example of TEMP files.

<H2><a id="P2.3">2.3</A>: TARGET</H2>

TARGET files are the final outputs from the compilation process 
which are required by the runtime system. TARGET files are not 
backed up and may be safely deleted in a total cleanup (such as 
when the runtime system is inactive for a long period) because 
they can be regenerated via compilation.<P>

<H2><a id="P2.4">2.4</A>: STANDARD</H2>

The STANDARD category was created to handle files which may need 
to be in your directory which you didn't create and which don't 
need to be backed up because they are part of some other 
distribution which is backed up separately. I use this category 
to avoid backing up standard operating system files which can be 
recovered from the standard distribution.

<H2><a id="P3">3</A>: Categorize Your Files</H2>

Every file in a directory should be classified into one of these 
categories. Before actually performing the backup operation, 
Backup3 will check to see that you have properly categorized all 
the files in the directory. Any file whose type is not known will 
generate an error:

<PRE>
      ==> working.file
</PRE>

You should decide whether these files fall into one of the above 
categories. You should then edit your .spec file or your Makefile 
to include these files or alternately delete the files if they 
are obsolete or otherwise don't belong in the directory.

<H2><a id="P4">4</A>: Performing a Backup</H2>

In order to backup a directory, you must change to that directory 
and invoke Backup3. Backup3 will create a mirror directory as a 
subdirectory of /tmp which will contain links to the source 
files. It is this mirror directory which is actually archived.
Backup3 invokes the standard QNX pax utility to pack all the 
files into a single archive, then it invokes the QNX freeze 
utility to compress the archive.<P>

There are several options to determine what Backup3 should do 
with this archive once created.

<H2><a id="P4.1">4.1</A>: Backing up to Floppy</H2>

By default, Backup3 will write the compressed archive to the raw 
floppy disk in /dev/fd0. This floppy must have been low-level 
formatted, but it does not need to have a file system installed 
or mounted. A formatted DOS diskette will work, but it will cease 
to be a DOS diskette after writing this backup to it.<P>

Because this method does not use a file structure, it cannot 
tolerate any flaws on the diskette, so the diskette should be 
checked initially to make sure it has no flaws. The DOS format 
utility does this sort of check and reports the number of bad 
blocks after the disk is formatted. Any bad blocks indicates that 
the disk should not be used with Backup3. Since a file system can 
work around bad blocks, such a disk may be still be useful for 
other purposes, but don't try to backup to it or you may not be 
able to restore reliably.<P>

We also have a utility to perform this low-level format and check 
the disk under QNX called flinit, though at present it is 
somewhat lacking in general applicability.<P>

An alternate floppy device can be selected either by using the -d 
option to Backup3 or by setting the <A HREF="#ARCDEV">ARCDEV</A> 
environment variable.<P>

In order to write to the raw floppy, you must have write 
permission on the floppy device. This can be tricky, and I 
haven't developed a general approach. For this reason, it may be 
generally more convenient to backup to a file.

<H2><a id="P4.2">4.2</A>: Backing up to a File</H2>

To write the compressed archive to a file, simply specify the 
filename with the -d argument:
<PRE>
      Backup3 -d ~/abc.pax.F
</PRE>
Specifying a file type of .pax.F marks the archive as a 
compressed archive in case you forget. Using this approach, the 
archive could be written to a DOS floppy (provided the name was 
constrained to DOS's 8.3 format):
<PRE>
      Backup3 -d /dos/a/abcpax.f
</PRE>

<H2><a id="P4.3">4.3</A>: Backing up Remotely</H2>

If you have a QNX machine at a remote location and dial in using 
qtalk, you can use the -q option to automatically transmit the 
compressed archive using QNX's qcp protocol. This will not work 
if you are dialing in from a DOS machine which doesn't support 
qcp.

<H2><a id="P5">5</A>: Incremental Backups</H2>

Backup3 supports incremental backups through the -l option. By 
default, Backup3 performs a level 0 backup, saving all the source 
files into a single archive. A level 1 backup, designated by "-l 
1" backs up only those source files which have changed since the 
most recent level 0 backup. Similarly, a level 2 backup saves 
only files which have changed since the more recent level 1 
backup.<P>

Needless to say, a level 1 backup is of relatively little value 
without the corresponding level 0 backup, so be sure not to 
overwrite your level 0 backup with your level 1 backup.<P>

For most single directories, there is little need to use 
incremental backups since the full backup is relatively quick.

<H2><a id="P6">6</A>: Alternate Invocations</H2>

The -t option controls how much work Backup3 does to guarantee 
a comprehensive backup of your application. The four optional 
modes are Backup, Archive, Copyout and CopyRCS. Backup and 
Archive check each file in the directory agains the SOURCE, 
OBJECT, TARGET and STANDARD categories. Copyout and CopyRCS do 
not perform that test, but simply backup those files which are 
already designated as SOURCE. Archive and CopyRCS will backup any 
RCS subdirectories in their entirety; Backup and Copyout will 
not. The default mode is Archive, and I recommend that you always 
use the default except in dire circumstances.

<H2><a id="P7">7</A>: Restoring from a Backup</H2>

The utility to restore a backup is Copyin3. It restores the files 
into the mirror directory, then compares each file against the 
existing directory to see if the file is newer. If the file is 
newer, it asks whether the old file should be overwritten.<P>

When you get quite confident of Copyin3's operation, you can use 
the -R (Rambo) option, which will overwrite older files without 
asking.<P>

The -s option to Copyin3 allows you to specify the location of 
the compressed archive.

<H2><a id="A.A">A.A</A>: Appendix A: Environment Variables</H2>

ARCDEV specifies where the compressed archive should be written. 
The default is /dev/fd0, the raw floppy device on the local 
node.<P>

TMPDIR specifies the directory in which to build the mirror 
directories. This is defined in the standard environment and is 
usually /tmp.<P>

MKVERBOSE, if defined to be a nonempty string, will cause all 
sorts of verbose output to appear on your screen, obliterating 
what you really want to see. I used it when initially debugging 
these applications.

<H2><a id="A.B">A.B</A>: Appendix B: Caveats</H2>

The /tmp directory and the directory being backed up must reside 
on the same filesystem (disk) or the method of using hard links 
between the mirror directory and the source directory will fail. 
This is an issue if you are backing up a directory from a remote 
machine. One way to work around this is to change your 
root:
<PRE>
      cd //4/home/clono2/src
	  on -r //4/ Backup3 -d ~/clono2.pax.F
</PRE>
<hr>
<p>Return to <a href="index.html">Manuals Guide</a></p>
<hr>
<table style="border: none; width: 100%">
<tr><td>last updated: Thu Jan  2 10:56:25 2003</td>
  <td style="text-align: right"><a href="mailto:webmaster@huarp.harvard.edu">webmaster@huarp.harvard.edu</a></td></tr>
<tr><td colspan="2" style="font-size: smaller">
Copyright 2002 by the President and Fellows of Harvard College
</td></tr></table>
</body>
</html>
